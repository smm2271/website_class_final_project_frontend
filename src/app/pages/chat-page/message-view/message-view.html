<div class="message-view-container">
    @if (selectedRoom()) {
    <div class="chat-header">
        <div class="header-left">
            <button class="btn-back" (click)="goBack()">
                <span class="icon">â†</span>
            </button>
            <div class="room-info">
                <div class="room-name">{{ selectedRoom()?.name }}</div>
                <div class="room-status">ç·šä¸Šé€£ç·šä¸­</div>
            </div>
        </div>
        <div class="header-right">
            <button class="btn-info" (click)="showChatID()">ID</button>
        </div>
    </div>

    <div class="message-list" #messageContainer>
        @for (message of historyMessageList(); track message.id) {
        <div class="message-row"
            [class.self]="message.author_id === userService.user()?.id || message.author_id === userService.user()?.email">
            <div class="avatar">{{ message.author_name ? message.author_name[0] : 'U' }}</div>
            <div class="message-content">
                @if (message.author_id !== userService.user()?.id) {
                <div class="author-name">
                    {{ message.author_name }}
                </div>
                }
                <div class="bubble">
                    {{ message.content }}
                </div>
                <div class="time">{{ message.created_at | date:'HH:mm':'GMT+8' }}</div>
            </div>
        </div>
        } @empty {
        <div class="empty-state">
            <div class="empty-icon">ğŸ’¬</div>
            <p>å°šç„¡è¨Šæ¯ï¼Œæ‰“å€‹æ‹›å‘¼å§ï¼</p>
        </div>
        }
    </div>

    <div class="input-area">
        <form (submit)="sendMessage(); $event.preventDefault()" class="input-form">
            <input type="text" [ngModel]="newMessage()" (ngModelChange)="newMessage.set($event)" name="messageInput"
                placeholder="è¼¸å…¥è¨Šæ¯..." autocomplete="off" />
            <button type="submit" [disabled]="!newMessage().trim()">
                <span class="send-icon">â¤</span>
            </button>
        </form>
    </div>
    } @else {
    <div class="no-selection">
        <div class="illustration">ğŸŒ¸</div>
        <h2>æ­¡è¿ä¾†åˆ°èŠå¤©å®¤</h2>
        <p>è«‹å¾å·¦å´é¸å–®é¸æ“‡ä¸€å€‹æˆ¿é–“é–‹å§‹èŠå¤©</p>
    </div>
    }
</div>
